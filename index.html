<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DMCC News Feed</title>

  <style>
    :root { --border:#e9e9e9; --text:#111; --muted:#666; }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      color: var(--text);
      background: #fff;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px 18px; }
    h1 { margin: 0 0 12px; font-size: 18px; font-weight: 700; }

    .item {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 18px;
      padding: 18px 0;
      border-bottom: 1px solid var(--border);
      align-items: start;
    }
    .media img {
      width: 100%;
      height: auto;
      border-radius: 6px;
      display: block;
    }
    .title {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 8px;
      line-height: 1.25;
    }
    .title a { color: var(--text); text-decoration: none; }
    .title a:hover { text-decoration: underline; }

    .meta {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
    }
    .desc {
      font-size: 13px;
      line-height: 1.5;
      color: #222;
    }

    /* Make it responsive for smaller iframe widths */
    @media (max-width: 820px) {
      .item { grid-template-columns: 1fr; }
      .media { order: 1; }
      .content { order: 2; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>DMCC News Feed</h1>
    <div id="feed">Loading…</div>
  </div>

  <script>
    // ✅ Put your RSS URL here
    const RSS_URL = "https://dmcc.ae/latest-news/rss.xml";

    // Uses a public RSS->JSON converter to avoid browser CORS problems.
    const API = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(RSS_URL);

    function decodeHtmlEntities(s) {
      const txt = document.createElement("textarea");
      txt.innerHTML = s || "";
      return txt.value;
    }

    function stripHtml(html) {
      const div = document.createElement("div");
      div.innerHTML = html || "";
      return (div.textContent || div.innerText || "").replace(/\s+/g, " ").trim();
    }

    function firstImageFromHtml(html) {
      const m = /<img[^>]+src=["']([^"']+)["']/i.exec(html || "");
      return m ? m[1] : "";
    }

    function formatDate(pubDate) {
      if (!pubDate) return "";
      const d = new Date(pubDate);
      if (isNaN(d.getTime())) return pubDate;
      return d.toLocaleString(undefined, { year: "numeric", month: "long", day: "2-digit" });
    }

    fetch(API)
      .then(r => r.json())
      .then(data => {
        const items = (data.items || []).slice(0, 8);

        if (!items.length) {
          document.getElementById("feed").textContent = "No items found.";
          return;
        }

        const html = items.map(it => {
          // ✅ Fallback: some feeds put text in content instead of description
          const descHtml = decodeHtmlEntities(it.description || it.content || "");

          // Extract first image (if present)
          const img = firstImageFromHtml(descHtml);

          // Plain text preview
          const text = stripHtml(descHtml);
          const preview = text.length > 340 ? (text.slice(0, 340) + "…") : text;

          return `
            <div class="item">
              <div class="media">
                ${img ? `
                  <a href="${it.link}" target="_blank" rel="noopener">
                    <img src="${img}" alt="">
                  </a>
                ` : ``}
              </div>

              <div class="content">
                <div class="title">
                  <a href="${it.link}" target="_blank" rel="noopener">${it.title}</a>
                </div>
                <div class="meta">${formatDate(it.pubDate)}</div>

                <!-- ✅ Only render description if there is actual text -->
                ${preview ? `<div class="desc">${preview}</div>` : ``}
              </div>
            </div>
          `;
        }).join("");

        document.getElementById("feed").innerHTML = html;
      })
      .catch(err => {
        console.error(err);
        document.getElementById("feed").textContent =
          "Failed to load feed. (If this happens, we’ll swap the RSS->JSON service or use a server-side proxy.)";
      });
  </script>
</body>
</html>
